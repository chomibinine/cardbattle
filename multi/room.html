
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë©€í‹°í”Œë ˆì´ ëŒ€ì „ (ì†ì„± + íŠ¹ìˆ˜ì¹´ë“œ)</title>
  <style>
    body { font-family: sans-serif; background: #000; color: #fff; text-align: center; }
    h1 { margin-top: 20px; font-size: 30px; }
    .area { margin: 30px 0; }
    .card { display: inline-block; padding: 10px; margin: 10px; background: #222; border: 2px solid #555; border-radius: 10px; width: 140px; height: 110px; cursor: pointer; }
    .card:hover { background: #333; }
    .selected { border: 2px solid yellow; background: #444; }
    #result { font-size: 20px; margin-top: 20px; }
  
<style>
  @media (max-width: 600px) {
    body { padding: 10px; font-size: 16px; }
    .card { width: 100px !important; font-size: 14px !important; }
    button { font-size: 16px !important; padding: 8px 14px !important; }
    #cardPool, #playerArea, #aiArea { display: flex; flex-wrap: wrap; justify-content: center; }
  }

<style>
.card {
  border: 2px solid #333;
  border-radius: 10px;
  width: 120px;
  height: 160px;
  margin: 10px;
  font-size: 16px;
  font-weight: bold;
  text-align: center;
  padding-top: 20px;
  box-shadow: 2px 2px 6px rgba(0,0,0,0.3);
  transition: transform 0.2s;
}
.card:hover {
  transform: scale(1.05);
}
.card.fire { background-color: #fdd; }
.card.water { background-color: #ddf; }
.card.grass { background-color: #dfd; }
.card.special { background-color: #ffd; border: 3px solid gold; }
.card .rank {
  display: block;
  font-size: 22px;
  margin-top: 20px;
  color: #333;
}
</style>

</style>


<style>
.card {
  border: 2px solid #333;
  border-radius: 10px;
  width: 120px;
  height: 160px;
  margin: 10px;
  font-size: 16px;
  font-weight: bold;
  text-align: center;
  padding-top: 20px;
  box-shadow: 2px 2px 6px rgba(0,0,0,0.3);
  transition: transform 0.2s;
}
.card:hover {
  transform: scale(1.05);
}
.card.fire { background-color: #fdd; }
.card.water { background-color: #ddf; }
.card.grass { background-color: #dfd; }
.card.special { background-color: #ffd; border: 3px solid gold; }
.card .rank {
  display: block;
  font-size: 22px;
  margin-top: 20px;
  color: #333;
}
</style>

</style>
</head>
<body>
  <h1>ğŸ§© ë©€í‹° ëŒ€ì „: ì†ì„± + íŠ¹ìˆ˜ì¹´ë“œ + í„´ì œ</h1>
  <div id="status">ìƒëŒ€ë°©ì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...</div>
  <div class="area" id="playerCards"></div><div id="turnInfo">í˜„ì¬ í„´: 1</div><div id="remainingCards">ë‚¨ì€ ì¹´ë“œ: 5ì¥</div>
  <div class="area" id="opponentStatus">ìƒëŒ€ë°©ì´ ì¹´ë“œë¥¼ ì„ íƒ ì¤‘ì…ë‹ˆë‹¤...</div>
  <div id="result"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBkDL4r-TwmNuUv5riVlNDeAnpibpcedPA",
      authDomain: "card-83d5a.firebaseapp.com",
      projectId: "card-83d5a",
      storageBucket: "card-83d5a.appspot.com",
      messagingSenderId: "83854808155",
      appId: "1:83854808155:web:7dc0e45d257118aa8b1b7e",
      databaseURL: "https://card-83d5a-default-rtdb.firebaseio.com/"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const url = new URL(location.href);
    const roomId = url.searchParams.get("room");
    const player = url.searchParams.get("player");
    const nick = url.searchParams.get("nick");

    const playerKey = "p" + player;
    const enemyKey = player === "1" ? "p2" : "p1";

    
const advantage = {
  fire: "grass",
  grass: "water",
  water: "fire"
};


    const cards = [{"name": "ë³‘ì‚¬", "rank": 1, "element": "fire", "type": "normal"}, {"name": "ê¶ìˆ˜", "rank": 2, "element": "grass", "type": "normal"}, {"name": "ê¸°ì‚¬", "rank": 3, "element": "water", "type": "normal"}, {"name": "ë§ˆë²•ì‚¬", "rank": 4, "element": "fire", "type": "normal"}, {"name": "ì™•", "rank": 5, "element": "grass", "type": "normal"}, {"name": "ì—­ì „ì˜ í•œìˆ˜", "type": "special", "effect": "force_win"}];

    let selectedCard = null;
let turn = 1;
let usedCards = [];
let myDeck = JSON.parse(localStorage.getItem('myDeck')) || [];
cards = myDeck;
let win = 0;
let lose = 0;
let draw = 0;
let turn = 1;
let usedCards = [];
let myDeck = JSON.parse(localStorage.getItem('myDeck')) || [];
cards = myDeck;

    const area = document.getElementById("playerCards");
    function renderDeck() {
      area.innerHTML = "";
      cards.filter(c => !usedCards.includes(c.name)).forEach((c) => {
      const div = document.createElement("div");
      div.className = "card";
      div.innerHTML = `<strong>${c.name}</strong><br>` + (c.type === "special" ? "íŠ¹ìˆ˜ì¹´ë“œ" : `ê³„ê¸‰: ${c.rank}<br>ì†ì„±: ${c.element}`);
      div.onclick = () => {
        document.querySelectorAll(".card").forEach(x => x.classList.remove("selected"));
        div.classList.add("selected");
        selectedCard = c;
        usedCards.push(c.name);
        turn++;
        document.getElementById("turnInfo").innerText = `í˜„ì¬ í„´: ${turn}`;
        renderDeck();
document.getElementById("remainingCards").innerText = `ë‚¨ì€ ì¹´ë“œ: ${cards.length - usedCards.length}ì¥`;
        set(ref(db, "rooms/" + roomId + "/" + playerKey + "_card"), c);
      };
      area.appendChild(div); }); }
renderDeck();
document.getElementById("remainingCards").innerText = `ë‚¨ì€ ì¹´ë“œ: ${cards.length - usedCards.length}ì¥`;
    });

    const status = document.getElementById("status");
    const opponentStatus = document.getElementById("opponentStatus");
    const result = document.getElementById("result");

    onValue(ref(db, "rooms/" + roomId + "/" + enemyKey + "_card"), snapshot => {
      const enemyCard = snapshot.val();
      if (enemyCard && selectedCard) {
        opponentStatus.innerHTML = `<strong>${enemyCard.name}</strong> ì„ íƒë¨`;

        // ìŠ¹ë¶€ ë¡œì§
        let outcome = "ğŸ¤ ë¬´ìŠ¹ë¶€!";
        if (selectedCard.type === "special" && selectedCard.effect === "force_win") {
          outcome = "ğŸ‰ íŠ¹ìˆ˜ì¹´ë“œ ë°œë™! ìŠ¹ë¦¬!";
        } else if (enemyCard.type === "special" && enemyCard.effect === "force_win") {
          outcome = "ğŸ’¥ ìƒëŒ€ íŠ¹ìˆ˜ì¹´ë“œ ë°œë™! íŒ¨ë°°!";
        } else if (advantage[selectedCard.element] === enemyCard.element) {
          outcome = "ğŸ¯ ì†ì„± ìš°ìœ„ë¡œ ìŠ¹ë¦¬!";
        } else if (advantage[enemyCard.element] === selectedCard.element) {
          outcome = "âš¡ ì†ì„± ì—´ì„¸ë¡œ íŒ¨ë°°!";
        } else {
          if (selectedCard.rank > enemyCard.rank) outcome = "ğŸ‰ ê³„ê¸‰ ìš°ìœ„ë¡œ ìŠ¹ë¦¬!";
          else if (selectedCard.rank < enemyCard.rank) outcome = "ğŸ’¥ ê³„ê¸‰ ì—´ì„¸ë¡œ íŒ¨ë°°!";
        }
        result.innerText = outcome;
if (outcome.includes("ìŠ¹ë¦¬")) win++;
else if (outcome.includes("íŒ¨ë°°")) lose++;
else draw++;

if (turn > 5) {
  let summary = `ğŸ¯ ì´ ê²°ê³¼ - ìŠ¹: ${win} / íŒ¨: ${lose} / ë¬´: ${draw}\n`;
  if (win > lose) summary += "ğŸ‰ ìµœì¢… ìŠ¹ë¦¬!";
  else if (win < lose) summary += "ğŸ’¥ ìµœì¢… íŒ¨ë°°!";
  else summary += "ğŸ¤ ìµœì¢… ë¬´ìŠ¹ë¶€!";
  alert(summary);
}
        status.innerText = "ì „íˆ¬ ì™„ë£Œ!";
      }
    });
  </script>
</body>
</html>
